"use strict";window.addEventListener("load",function(){const e=(()=>{const e=document.getElementsByTagName("html")[0].namespaceURI,t=(i,s,d)=>{"string"==typeof s?s.split("\n").forEach((t,s)=>{s>0&&!d&&i.appendChild(document.createElementNS(e,"br")),i.appendChild(document.createTextNode(t))}):s&&(s.hasOwnProperty("length")?Array.from(s).forEach(e=>t(i,e,d)):i.appendChild(s))};return(i,s,d,l)=>{const o="string"==typeof i?document.createElementNS(e,i):i;return"string"==typeof s&&([s,d]=[d,s]),"object"==typeof s&&Object.keys(s).forEach(e=>{let t=s[e];void 0!==t&&("on"===e.substr(0,2)&&"function"==typeof t?o.addEventListener(e.substr(2),t.bind(o)):o.setAttribute(e,t))}),t(o,d,l),o}})(),t=e("div",{id:"info"}),i=document.body.appendChild(e("button","Add Category",{onclick:function(){t.appendChild(e("div",{},[e("button",{class:"closer",onclick:function(){t.removeChild(this.parentNode)}},"X"),e("input",{onfocus:function(){this.removeAttribute("class")}}),e("ol",{},Array.from({length:s},()=>e("li",{},e("input",{onfocus:function(){this.removeAttribute("class")}}))))]))}}));let s=2;document.body.appendChild(e("button","Add Row",{onclick:function(){s++,Array.from(t.getElementsByTagName("ol")).forEach(t=>t.appendChild(e("li",{},e("input",{onfocus:function(){this.removeAttribute("class")}}))))}})),document.body.appendChild(e("button","Remove Row",{onclick:()=>{s>0&&(s--,Array.from(t.getElementsByTagName("ol")).forEach(e=>e.hasChildNodes()&&e.removeChild(e.lastChild)))}})),document.body.appendChild(t),i.click(),i.click(),i.click(),document.body.insertBefore(e("button","Start",{onclick:function(){if(t.childElementCount<3||s<2)return void alert("Need a minimum of 3 categories and 2 rows");const i=Array.from(t.getElementsByTagName("div"),e=>{const t=Array.from(e.getElementsByTagName("input"));return{Title:t[0].value,Values:t.slice(1).map(e=>e.value)}});if(!i.map(e=>e.Title.replace(/[ |:]/,"_").toUpperCase()).map((e,i,s)=>s.indexOf(e)===i||(t.getElementsByTagName("div")[i].getElementsByTagName("input")[0].setAttribute("class","error"),!1)).reduce((e,t)=>t&&e)||!i.map((e,i)=>e.Values.map(e=>e.replace(/[ |:]/,"_").toUpperCase()).map((e,s,d)=>d.indexOf(e)===s||(t.getElementsByTagName("div")[i].getElementsByTagName("input")[s+1].setAttribute("class","error"),!1)).reduce((e,t)=>e&&t)).reduce((e,t)=>e&&t))return;const d=e("table"),l=[],o=[],n=o.forEach.bind(o,e=>e.Update()),a=(e,t)=>Object.assign(e,t),r=i.map(e=>new Object({[e.Title]:e.Values.map(t=>new Object({[t]:i.filter(t=>t!=e).map(e=>new Object({[e.Title]:e.Values.map(e=>new Object({[e]:null})).reduce(a,{})})).reduce(a,{})})).reduce(a,{})})).reduce(a,{}),c=(e,t)=>e||t,u=(()=>{const e=i.map(e=>e.Title),t=e.reduce((e,t,s)=>(e[t]=i[s].Values,e),{}),s=(e,i,s)=>t[e].map(t=>0===r[i][s][e][t].Get()?1:0).reduce((e,t,i)=>e|=t<<i);return()=>e.map(t=>e.filter(e=>e!=t).map(e=>Object.keys(r[e]).map(d=>{const l=s(t,e,d);return l>0&&i.map(e=>e.Title).filter(i=>i!==t&&i!==e).map(i=>Object.keys(r[i]).filter(e=>{const d=s(t,i,e);return d>0&&0==(d&l)}).map(t=>0===r[e][d][i][t].Get()&&(r[e][d][i][t].Set(-1),!0)).reduce(c,!1)).reduce(c,!1)}).reduce(c,!1)).reduce(c,!1)).reduce(c,!1)})(),h=/[ :|]/g;(e=>{for(;e.hasChildNodes();)e.removeChild(e.lastChild)})(document.body),document.body.appendChild(e("table",{},[e("thead",{},[e("tr",{},[e("td",{colspan:"2",rowspan:"2"}),i.slice(1).map(t=>e("th",{colspan:s},t.Title))]),e("tr",{},i.slice(1).map(t=>t.Values.map((t,i)=>e("th",0===i?{class:"first"}:{},e("div",t)))))]),e("tbody",{},i.slice(2).concat(i[0]).reverse().map((t,d)=>t.Values.map((l,n)=>e("tr",0===n?{class:"first"}:{},[0===n?[e("th",{class:"cat",rowspan:s},e("div",t.Title))]:[],e("th",0===n?{class:"first"}:{},l),i.slice(1,i.length-d).map(i=>i.Values.map((s,d)=>{const n=e("td",{class:0===d?"first":"",id:(t.Title.replace(h,"_")+":"+l.replace(h,"_")+"|"+i.Title.replace(h,"_")+":"+s.replace(h,"_")).toUpperCase(),onclick:()=>{1===a.Get()?a.Set(0):a.Set(1),a.Update()},oncontextmenu:e=>{e.preventDefault(),-1==a.Get()?a.Set(0):a.Set(-1),a.Update()}}),a=new class{constructor(e,t,i){this.cell=e,this.cats=t,this.vals=i,this.unique=[],this.value=0}Get(){return this.value}Set(e){this.value=e}Update(){this.cell.setAttribute("class",(this.cell.getAttribute("class").includes("first")?"first ":"")+(1==this.value?"on":-1==this.value?"off":""))}AddUnique(e){this.unique.push(e)}Solve(e){let t=!1;const i=this;return 0===this.Get()&&(this.unique.some(e=>e.every(e=>-1===e.Get()))?(this.Set(1),t=!0):this.unique.some(e=>1===e.filter(e=>1===e.Get()).length)&&(this.Set(-1),t=!0)),1===this.Get()&&Object.keys(e[this.cats[0]][this.vals[0]]).filter(e=>e!==this.cats[1]).forEach(s=>Object.keys(e[this.cats[0]][this.vals[0]][s]).forEach(d=>{const l=e[i.cats[0]][i.vals[0]][s][d],o=e[i.cats[1]][i.vals[1]][s][d];0!==l.Get()&&0===o.Get()?(o.Set(l.Get()),t=!0):0!==o.Get()&&0===l.Get()&&(l.Set(o.Get()),t=!0)})),t}Sanity(){switch(this.Get()){case-1:if(this.unique.some(e=>e.every(e=>-1===e.Get())))return!1;break;case 1:if(this.unique.some(e=>e.some(e=>1===e.Get())))return!1}return!0}}(n,[t.Title,i.Title],[l,s]);return o.push(a),r[t.Title][l][i.Title][s]=a,r[i.Title][s][t.Title][l]=a,n})),0===d?[]:[e("td",{class:"span",colspan:d*s})]]))))])),document.body.appendChild(e("button","Solve",{onclick:()=>{if(o.filter(e=>!e.Sanity()).length>0)alert("Invalid State");else{for(;o.map(e=>e.Solve(r)).reduce(c,!1)||l.map(e=>e()).reduce(c,!1)||u(););o.filter(e=>!e.Sanity()).length>0&&alert("Invalid State"),n()}}})),document.body.appendChild(e("button","Add Rule",{onclick:function(){const t=()=>{},o=()=>{[0,1,2,6,7].every(e=>p[e].selectedIndex>0)&&done.removeAttribute("disabled")},n=()=>{h[3].textContent=(m.checked?"Not ":"")+(p[3].selectedIndex>0&&0===p[4].selectedIndex&&0===p[5].selectedIndex?"Adjacent To":(p[3].selectedIndex>0?p[3].value+" "+(p[4].selectedIndex+1)+" ":"")+p[5].value)},a=e(new DocumentFragment,{},i.map(t=>e("option",{value:t.Title},t.Title))),c=e(new DocumentFragment,{},i.map(t=>e("optgroup",{label:t.Title},t.Values.map(t=>e("option",{value:t},t))))),u=e("div",{id:"overlay"},[e("div",{},[e("button","X",{id:"closer",onclick:()=>{document.body.removeChild(u)}}),e("h1","Add Rule"),e("div",{id:"rule"},["In Category ","Category A",", Category ","Category B",", Row ","Row B"," is ","Rule"," Category ","Category C",", Row ","Row C","."].map((t,i)=>0==(1&i)?t:e("span",{title:t},"???"))),[["Category A",function(){0!==this.selectedIndex&&(this.childNodes[0].setAttribute("disabled","disabled"),this.childNodes[0].style.display="none",[p[1],p[6]].forEach(e=>{e.removeAttribute("disabled"),Array.from(e.childNodes).forEach(e=>e.removeAttribute("disabled")),e.childNodes[this.selectedIndex].setAttribute("disabled","disabled")}),h[0].textContent=this.childNodes[this.selectedIndex].getAttribute("value"),o())},[e("option","--Choose Main Category--"),a.cloneNode(!0)]],["Category B",function(){0!==this.selectedIndex&&(this.childNodes[0].setAttribute("disabled","disabled"),this.childNodes[0].style.display="none",Array.from(p[2].childNodes).forEach(e=>e.style.display="none"),p[2].childNodes[this.selectedIndex].style.display="",p[2].removeAttribute("disabled"),p[2].selectedIndex=0,h[1].textContent=this.childNodes[this.selectedIndex].getAttribute("value"),h[2].textContent="???",o())},[e("option","--Choose Second Category--"),a.cloneNode(!0)]],["Value B",function(){0!==this.selectedIndex&&(this.childNodes[0].setAttribute("disabled","disabled"),this.childNodes[0].style.display="none",Array.from(p[7].childNodes).filter((e,t)=>0!=t).forEach(e=>e.childNodes.forEach(e=>e.removeAttribute("disabled"))),p[7].getElementsByTagName("option")[this.selectedIndex].setAttribute("disabled","disabled"),h[2].textContent=this.getElementsByTagName("option")[this.selectedIndex].getAttribute("value"),o())},[e("option","--Choose Category Row--"),c.cloneNode(!0)]],["Not",n],["Within",function(){switch(this.selectedIndex){case 0:p[5].firstChild.textContent="On One Side Of";break;case 1:p[5].firstChild.textContent="Of";break;case 2:p[5].firstChild.textContent="From"}p[5].firstChild.value=p[5].firstChild.textContent,0===this.selectedIndex?p[4].setAttribute("disabled","disabled"):p[4].removeAttribute("disabled"),n()},["","Within","Exactly"].map(t=>e("option",{value:t},t))],["Distance",n,Array.from({length:s},(e,t)=>(t+1).toString()).map(t=>e("option",{value:t},t))],["Direction",n,["","After","Before"].map(t=>e("option",{value:t},t))],["Category C",function(){0!==this.selectedIndex&&(this.childNodes[0].setAttribute("disabled","disabled"),this.childNodes[0].style.display="none",Array.from(p[7].childNodes).forEach(e=>e.style.display="none"),p[7].childNodes[this.selectedIndex].style.display="",p[7].removeAttribute("disabled"),p[7].selectedIndex=0,h[4].textContent=this.childNodes[this.selectedIndex].getAttribute("value"),h[5].textContent="???",o())},[e("option","--Choose Third Category--"),a.cloneNode(!0)]],["Value C",function(){0!==this.selectedIndex&&(this.childNodes[0].setAttribute("disabled","disabled"),this.childNodes[0].style.display="none",Array.from(p[2].childNodes).filter((e,t)=>0!=t).forEach(e=>e.childNodes.forEach(e=>e.removeAttribute("disabled"))),p[2].getElementsByTagName("option")[this.selectedIndex].setAttribute("disabled","disabled"),h[5].textContent=this.getElementsByTagName("option")[this.selectedIndex].getAttribute("value"),o())},[e("option","--Choose Category Row--"),c.cloneNode(!0)]]].map(t=>[e("label",{for:t[0].split(" ").map((e,t)=>0===t?e.toLowerCase():e).join("")},t[0]),e("Not"===t[0]?"input":"select",{id:t[0].split(" ").map((e,t)=>0===t?e.toLowerCase():e).join(""),type:"Not"===t[0]?"checkbox":void 0,onchange:t[1]},t[2]),e("br")]),e("button","Add",{disabled:"disabled",id:"done",onclick:function(){const i=l.push(((e,t,i,d,l,o,n,a)=>{let c=!1;const u=r[t][i][e],h=r[d][l][e];return[[u,h],[h,u]].forEach(e=>{Object.keys(e[0]).forEach((t,i)=>{if(0!==e[0][t].Get())return;let d=[];n>-1&&(a<0?d=d.concat(Array(-a).fill(0).map((e,t)=>i-t-1)):d.push(i-a)),n<1&&(a<0?d=d.concat(Array(-a).fill(0).map((e,t)=>t+i+1)):d.push(i+a)),d=d.filter(e=>e>=0&&e<s),o&&(d=Array(s).fill(0).map((e,t)=>t).filter(e=>!d.includes(e))),d.every(t=>-1===e[1][Object.keys(e[1])[t]].Get())&&(e[0][t].Set(-1),c=!0)}),n=-n}),c}).bind(null,p[0].value,p[1].value,p[2].value,p[6].value,p[7].value,m.checked,2===p[5].selectedIndex?-1:p[5].selectedIndex,0===p[3].selectedIndex?-s:(p[4].selectedIndex+1)*(1===p[4].selectedIndex?-1:1)))-1;d.appendChild(e("tr",{},e("td",{},[e("button","X",{onclick:function(){d.removeChild(this.parentNode.parentNode),l[i]=t}}),e("span",document.getElementById("rule").textContent)]))),closer.click()}})])]),h=Array.from(u.getElementsByTagName("span")),p=Array.from(u.getElementsByTagName("select")),m=u.getElementsByTagName("input")[0];return()=>{h.forEach(e=>e.textContent="???"),p[0].childNodes[0].style.display="",p[0].childNodes[0].removeAttribute("disabled"),p[0].selectedIndex=0,[1,2,6,7].map(e=>p[e]).forEach(e=>{e.setAttribute("disabled","disabled"),e.style.display="",e.selectedIndex=0,Array.from(e.childNodes).forEach(e=>{e.removeAttribute("disabled"),e.style.display="",Array.from(e.childNodes).filter(e=>3!==e.nodeType).forEach(e=>{e.removeAttribute("disabled")})})}),m.checked=!1,p[3].selectedIndex=0,p[4].selectedIndex=0,p[5].selectedIndex=0,p[4].setAttribute("disabled","disabled"),p[5].firstChild.textContent="On One Side Of",p[5].firstChild.value=p[5].firstChild.textContent,u.firstChild.lastChild.setAttribute("disabled","disabled"),n(),document.body.appendChild(u)}}()})),document.body.appendChild(d),Object.values(r).forEach(e=>Object.values(e).forEach(e=>Object.values(e).forEach(e=>Object.keys(e).forEach(t=>e[t].AddUnique(Object.keys(e).filter(e=>e!=t).map(t=>e[t]))))))}}),document.body.insertBefore(e("br"),t))});
